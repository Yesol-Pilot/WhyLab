# WhyLab v2.0 — Causal Audit Engine 상세 전략 및 아키텍처 설계서

> **문서 유형**: 심층 리서치 보고서  
> **작성일**: 2026-02-24  
> **목적**: Phase 1~4 로드맵의 학술적 근거 및 기술적 제약 분석  
> **상태**: 승인됨 — 인프라 반영 완료

---

## 1. 서론: 자율 에이전트 인과 감사(Causal Auditing)의 학술적 배경 및 갭(Gap) 분석

최근 인공지능 모델과 자율 에이전트가 의료, 금융, 교육, 소셜 미디어 등 다양한 의사결정 시스템에 광범위하게 배포됨에 따라, 이들의 행동을 감사(Auditing)하고 평가하는 방법론의 중요성이 전례 없이 급증하고 있다. 기존의 기계 학습(ML) 시스템 평가는 주로 '알고리즘 감사(Algorithmic Auditing)'라는 틀 안에서 이루어졌으며, 이는 관측된 데이터의 상관관계(Correlation)에 기반하여 모델의 편향성(Bias), 공정성(Fairness), 개인정보 보호(Privacy), 그리고 예측의 정확도(Accuracy)를 측정하는 데 집중해 왔다. 그러나 에이전트가 환경에 능동적으로 개입하고, 사용자의 선호도와 시스템의 상태에 미치는 다단계 동역학(Multi-step dynamics)을 고려할 때, 단순한 상관관계 분석은 시스템의 진정한 영향력을 평가하고 부작용을 통제하는 데 명확한 한계를 지닌다.

### 핵심 학술적 갭(Gap)

**"독립적인 다수의 에이전트가 실시간 웹 환경에서 동시다발적으로 내린 복합적 의사결정(Multi-treatment)의 인과적 효과를 어떻게 분리하고, 이를 외부 노이즈가 극심하고 트래픽이 극도로 희소한(Low-traffic) 환경에서 어떻게 통계적으로 유의미하게 검증할 것인가"**

### 기존 연구 현황

- **RCSA 프레임워크**: 인과적 영향력(CI) 측정 — `CI(X → Y) = P(Y | do(X)) - P(Y | X)`, 드리프트 인덱스(DI), 인과 감사 기록(CAR_t)
- **추천 시스템 인과 감사**: 미래/과거 도달 가능성(Reachability) 지표, 안정성(Stability)
- **한계**: 다중 처치(Multi-treatment) 환경에서 처치 간 상호작용 효과 분리 + 저 트래픽 환경 통제에 대한 엔드투엔드 파이프라인 부재

---

## 2. Phase 1: GA4 Data API 구조적 한계 및 Supabase 최적화

### 2.1 GA4 할당량 제약

| 할당량 유형 | 제한 수치 | 파이프라인 영향 |
|---|---|---|
| 동시 요청 | 속성당 10개 | 다수 에이전트 동시 조회 시 즉시 병목 |
| 시간당 토큰 | 40,000개 | 복잡 쿼리 시 기하급수적 소모 |
| 일일 토큰 | 200,000개 | 백그라운드 감사 작업 시 초과 위험 |

### 대안 아키텍처

1. **비동기 일괄 처리**: GA4 → BigQuery Raw Export → WhyLab Batch Read
2. **큐 기반 Lazy Fetching**: Decision 메타데이터만 즉시 기록 → 백그라운드 워커가 할당량 모니터링하며 지연 수집 (`returnPropertyQuota: true`)

### 2.2 Supabase 시계열 스키마 최적화

| 최적화 영역 | 전략 |
|---|---|
| **파티셔닝** | timescaledb 하이퍼테이블 또는 Postgres 네이티브 파티셔닝 (timestamp 기준) |
| **식별자** | UUID v7 / ULID (순차적, 충돌 방지) |
| **인덱싱** | 에이전트 ID + 처치 유형 복합 인덱스, 아카이빙 정책 |
| **커넥션 풀링** | Supavisor 경유 (FATAL: remaining connection slots 방지) |
| **보안/성능** | RLS 참조 컬럼 인덱스, security definer 함수, Materialized Views |

---

## 3. Phase 2: 다중 처치(Multi-Treatment) 분리 인과추론

### 3.1 이중 기계 학습(Double Machine Learning, DML)

- **목적**: 고차원 교란 변수 하에서 개별 처치 효과를 편향 없이 분리
- **메커니즘**: 교차 피팅(Cross-fitting) → 잔차 도출(Residualization) → 효과 추정
- **도구**: EconML `LinearDML` / `CausalForestDML`
- **보완**: 가우스 코풀라 기반 민감도 분석, MMoE 기반 M3E2 알고리즘

### 3.2 인과 섀플리 값(Causal Shapley Values) & DAG-SHAP

- **목적**: 에이전트 개별 결정의 국소적 기여도를 투명하게 분배
- **DAG-SHAP**: 엣지(Edge) 개입 기반으로 비인과적 상관성 차단
- **수식**: `Φ(k) = Σ_{i ∈ O_k} Ψ(e_i)` (발신 엣지 기여도 합)

---

## 4. Phase 2 연계: 시계열 인과추론 저 트래픽 환경 통제

### 4.1 CausalImpact (BSTS) 최소 요건

- 사전 데이터: 3~10주 일별 관측
- Pre/Post 비율: 2~3배 이상
- **한계**: 저 트래픽 시 사후 신뢰구간 팽창 → 위양성(False Positive) 폭증

### 4.2 합성 대조군(GSC) — 극복 방안

- **원리**: IFE 모델 기반 잠재 요인(Latent Factors) 추출 → 반사실적 결과 보간
- **강점**: 사전 차원 축소로 노이즈 평활화, 좁은 신뢰구간, 소표본 가능
- **구현**: 패라메트릭 부트스트랩으로 시계열 상관성 보존한 불확실성 추정

### 하이브리드 라우팅

| 조건 | 메서드 |
|---|---|
| 데이터 풍부 + 거시적 트렌드 | CausalImpact (BSTS) |
| 데이터 희소 + 높은 노이즈 | GSC (IFE) |

---

## 5. Phase 3: 피드백 루프 — 제어 이론적 안정성

### 위험 요인
- Collider → Confounder 오식별 시 인지 부조화 유발
- Sim2Real 갭, 굿하트의 법칙, 정책 진동(Policy oscillation)

### 적응형 감쇠 인자(Adaptive Damping Factor ζ)

- **정의**: `ζ = -Re(λ) / |λ|` (시스템 고유값 기반)
- **높은 ζ**: 빠른 수렴, 오버슈트 위험
- **낮은 ζ**: 안전하지만 진동 장기화

### 제어 정책

| 환경 상태 | ζ 조정 | 업데이트 모드 |
|---|---|---|
| 높은 신뢰도 + 낮은 DI | 상향 | Aggressive (빠른 반영) |
| 낮은 신뢰도 + 높은 DI | 하향 | Conservative (보수적 유지) |

---

## 6. Phase 4: 학술 타겟 (AAAI 2027)

### 예상 타임라인

| 일정 | 추정일 |
|---|---|
| 초록 등록 | 2026-06-29 |
| 본문 제출 | 2026-07-06 |
| 수락 통보 | 2026-09-07 |
| Camera-ready | 2026-11-12 |
| 학회 개최 | 2027-01-19 ~ 26 |

### 논문 3대 기여점

1. **DAG-SHAP + DML 하이브리드 아키텍처** — 다중 처치의 순수 인과적 기여도 추적
2. **희소 데이터 환경 인과 추론 한계 극복** — CausalImpact 위양성 규명 + GSC 대안 실증
3. **제어 이론 적응형 피드백** — 감쇠 인자(ζ) 기반 안정적 자가 향상 증명
